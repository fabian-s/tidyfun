<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Converting data to tf • tidyfun</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Converting data to tf">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidyfun</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/x01_tf_Vectors.html">tf Vectors and Operations</a>
    </li>
    <li>
      <a href="../articles/x02_Conversion.html">Converting data to tf</a>
    </li>
    <li>
      <a href="../articles/x03_Data_Wrangling.html">Data Wrangling</a>
    </li>
    <li>
      <a href="../articles/x04_Visualization.html">Visualization</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fabian-s/tidyfun">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Converting data to tf</h1>
                        <h4 class="author">Jeff Goldsmith</h4>
            
            <h4 class="date">2019-06-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/fabian-s/tidyfun/blob/master/vignettes/x02_Conversion.Rmd"><code>vignettes/x02_Conversion.Rmd</code></a></small>
      <div class="hidden name"><code>x02_Conversion.Rmd</code></div>

    </div>

    
    
<p>Functional data have often been stored in matrices or data frames. Although these structures have sufficed for some purposes, they are cumbersome or impossible to use with modern tools for data wrangling.</p>
<p>In this vignette, we illustrate how to convert data from common structures to <code>tf</code> objects. Throughout, functional data vectors are stored as columns in a data frame to facilitate subsequent wrangling and analysis.</p>
<div id="conversion-from-matrices" class="section level1">
<h1 class="hasAnchor">
<a href="#conversion-from-matrices" class="anchor"></a>Conversion from matrices</h1>
<p>One of the most common structures for storing functional data has been a matrix. Especially when subjects are observed over the same (regular or irregular) grid, it is natural to observations on a subject in rows (or columns) of a matrix. Matrices, however, are difficult to wrangle along with data in a data frame, leading to confusing and easy-to-break subsetting across several objects.</p>
<p>In the following examples, we’ll use <code>tfd</code> to get a <code>tf</code> vector from matrices. The <code>tfd</code> function expects data to be organized so that each row is the functional observation for a single subject. It’s possible to focus only on the resulting <code>tf</code> vector, but in keeping with the broader goals of <code>tidyfun</code> we’ll add these as columns to a data frame.</p>
<p>The <code>DTI</code> data in the <code>refund</code> package has been a popular example in functional data analysis. In the code below, we create a data frame (or <code>tibble</code>) containing scalar covariates, and then add columns for the <code>cca</code> and <code>rcst</code> track profiles. This code was used to create the <code><a href="../reference/dti_df.html">tidyfun::dti_df</a></code> dataset included in the package.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">dti_df =<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  <span class="dt">id =</span> refund<span class="op">::</span>DTI<span class="op">$</span>ID, </a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  <span class="dt">sex =</span> refund<span class="op">::</span>DTI<span class="op">$</span>sex, </a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  <span class="dt">case =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(refund<span class="op">::</span>DTI<span class="op">$</span>case, <span class="st">"MS"</span>, <span class="st">"control"</span>)))</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">dti_df<span class="op">$</span>cca =<span class="st"> </span><span class="kw"><a href="../reference/tfd.html">tfd</a></span>(refund<span class="op">::</span>DTI<span class="op">$</span>cca, <span class="dt">arg =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="dt">l =</span> <span class="dv">93</span>))</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">dti_df<span class="op">$</span>rcst =<span class="st"> </span><span class="kw"><a href="../reference/tfd.html">tfd</a></span>(refund<span class="op">::</span>DTI<span class="op">$</span>rcst, <span class="dt">arg =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">l =</span> <span class="dv">55</span>))</a></code></pre></div>
<p>In <code>tfd</code>, the first argument is a matrix; <code>arg</code> defines the grid over which functions are observed. The output of <code>tfd</code> is a vector, which we include in the <code>dti_df</code> data frame.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">dti_df</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">## # A tibble: 382 x 5</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">##       id sex    case   cca                        rcst                     </span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">##    &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;  &lt;tfd_irrg&gt;                 &lt;tfd_irrg&gt;               </span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">##  1  1001 female contr… 1001_1: (0.000,0.49);(0.0… 1001_1: (0.000,0.26);(0.…</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">##  2  1002 female contr… 1002_1: (0.000,0.47);(0.0… 1002_1: ( 0.22,0.44);( 0…</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">##  3  1003 male   contr… 1003_1: (0.000,0.50);(0.0… 1003_1: ( 0.22,0.42);( 0…</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">##  4  1004 male   contr… 1004_1: (0.000,0.40);(0.0… 1004_1: (0.000,0.51);(0.…</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">##  5  1005 male   contr… 1005_1: (0.000,0.40);(0.0… 1005_1: ( 0.22,0.40);( 0…</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">##  6  1006 male   contr… 1006_1: (0.000,0.45);(0.0… 1006_1: (0.056,0.47);(0.…</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">##  7  1007 male   contr… 1007_1: (0.000,0.55);(0.0… 1007_1: (0.000,0.52);(0.…</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">##  8  1008 male   contr… 1008_1: (0.000,0.45);(0.0… 1008_1: (0.000,0.33);(0.…</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">##  9  1009 male   contr… 1009_1: (0.000,0.50);(0.0… 1009_1: (0.000,0.57);(0.…</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">## 10  1010 male   contr… 1010_1: (0.000,0.46);(0.0… 1010_1: ( 0.22,0.44);( 0…</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">## # … with 372 more rows</span></a></code></pre></div>
<p>Finally, we’ll make a quick spaghetti plot to illustrate that the complete functional data is included in each <code>tf</code> column.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">dti_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/ggspaghetti.html">geom_spaghetti</a></span>(<span class="kw">aes</span>(<span class="dt">y =</span> cca, <span class="dt">col =</span> case, <span class="dt">alpha =</span> <span class="fl">.2</span> <span class="op">+</span><span class="st"> </span><span class="fl">.4</span><span class="op">*</span>(case <span class="op">==</span><span class="st"> "control"</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>sex) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_alpha</span>(<span class="dt">guide =</span> <span class="st">'none'</span>, <span class="dt">range =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(.<span class="dv">2</span>, <span class="fl">.4</span>))</a></code></pre></div>
<p><img src="x02_Conversion_files/figure-html/unnamed-chunk-3-1.png" width="90%"></p>
<p>We’ll repeat the same basic process using a second, and probably even-more-perennial, functional data example: the Canadian weather data in the <code>fda</code> package. Here, functional data are stored in a three-dimensional array, with dimesions corresponding to day, station, and outcome (temperature, precipitation, and log10 precipitation).</p>
<p>In the following, we: create a <code>tibble</code> with scalar covariates; use <code>tfd</code> to create functional data vectors; and include the resulting vectors in the dataframe. In this case, our <code>arg</code>s are days of the year, and we use <code>tf_smooth</code> to smooth the precipitation outcome. Because the matrices store functional data in columns rather than in rows, we transpose matrices in the call to <code>tfd</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">canada =<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="dt">place =</span> fda<span class="op">::</span>CanadianWeather<span class="op">$</span>place, </a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="dt">region =</span> fda<span class="op">::</span>CanadianWeather<span class="op">$</span>region, </a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  <span class="dt">lat =</span> fda<span class="op">::</span>CanadianWeather<span class="op">$</span>coordinates[,<span class="dv">1</span>], </a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="dt">lon =</span> <span class="op">-</span>fda<span class="op">::</span>CanadianWeather<span class="op">$</span>coordinates[,<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">canada<span class="op">$</span>temp =<span class="st"> </span><span class="kw"><a href="../reference/tfd.html">tfd</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(fda<span class="op">::</span>CanadianWeather<span class="op">$</span>dailyAv[,,<span class="dv">1</span>]), <span class="dt">arg =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">365</span>)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">canada<span class="op">$</span>precipl10 =<span class="st"> </span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="../reference/tfd.html">tfd</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(fda<span class="op">::</span>CanadianWeather<span class="op">$</span>dailyAv[,,<span class="dv">3</span>]), <span class="dt">arg =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">365</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="st">  </span>tf_smooth</a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">## using f = 0.15 as smoother span for lowess</span></a></code></pre></div>
<p>The resulting data frame is shown below.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">canada</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">## # A tibble: 35 x 6</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">##    place    region    lat   lon temp                   precipl10           </span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">##    &lt;chr&gt;    &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;tfd_reg&gt;              &lt;tfd_reg&gt;           </span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">##  1 St. Joh… Atlant…  47.3 -52.4 St. Johns: (1, -4);(2… [1]: (1,0.6);(2,0.6…</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">##  2 Halifax  Atlant…  44.4 -63.4 Halifax: (1, -4);(2, … [2]: (1,0.7);(2,0.7…</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">##  3 Sydney   Atlant…  46.1 -60.1 Sydney: (1, -4);(2, -… [3]: (1,0.7);(2,0.7…</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">##  4 Yarmouth Atlant…  43.5 -66.1 Yarmouth: (1, -1);(2,… [4]: (1,0.6);(2,0.6…</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">##  5 Charlot… Atlant…  42.5 -80.2 Charlottvl: (1, -6);(… [5]: (1,0.5);(2,0.5…</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">##  6 Frederi… Atlant…  45.6 -66.4 Fredericton: (1, -8);… [6]: (1,0.5);(2,0.5…</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">##  7 Scheffe… Atlant…  54.5 -64.5 Scheffervll: (1,-22);… [7]: (1,0.1);(2,0.1…</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">##  8 Arvida   Atlant…  48.3 -71.1 Arvida: (1,-14);(2,-1… [8]: (1,0.3);(2,0.3…</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">##  9 Bagottv… Atlant…  48.2 -70.5 Bagottville: (1,-15);… [9]: (1,0.3);(2,0.3…</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">## 10 Quebec   Atlant…  46.5 -71.1 Quebec: (1,-11);(2,-1… [10]: (1,0.4);(2,0.…</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">## # … with 25 more rows</span></a></code></pre></div>
<p>A plot containing both functional observations is shown below.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">temp_panel =</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span>canada <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> temp, <span class="dt">color =</span> region)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/ggspaghetti.html">geom_spaghetti</a></span>() </a>
<a class="sourceLine" id="cb6-4" data-line-number="4"></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">precip_panel =</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">  </span>canada <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> precipl10, <span class="dt">color =</span> region)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/ggspaghetti.html">geom_spaghetti</a></span>() </a>
<a class="sourceLine" id="cb6-8" data-line-number="8"></a>
<a class="sourceLine" id="cb6-9" data-line-number="9">gridExtra<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(temp_panel, precip_panel, <span class="dt">nrow =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="x02_Conversion_files/figure-html/unnamed-chunk-6-1.png" width="90%"></p>
</div>
<div id="conversion-from-a-data-frame" class="section level1">
<h1 class="hasAnchor">
<a href="#conversion-from-a-data-frame" class="anchor"></a>Conversion from a data frame</h1>
<div id="in-long-format" class="section level3">
<h3 class="hasAnchor">
<a href="#in-long-format" class="anchor"></a>… in “long” format</h3>
<p>“Long” format data frames containing functional data include columns containing a subject identifier, the functional argument, and the value each subject’s function takes at each argument. There are also often (but not always) non-functional covariates that are repeated within a subject. For data in this form, we use <code>tf_nest</code> to produce a data frame containing a single row for each subject.</p>
<p>A first example is the pig weight data from the <code>SemiPar</code> package, which is a nice example from longitudinal data analysis. This includes columns for <code>id.num</code>, <code>num.weeks</code>, and <code>weight</code> – which correspond to the subject, argument, and value.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"pig.weights"</span>, <span class="dt">package =</span> <span class="st">"SemiPar"</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">pig.weights =<span class="st"> </span><span class="kw">as_tibble</span>(pig.weights)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">pig.weights</a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">## # A tibble: 432 x 3</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">##    id.num num.weeks weight</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">##     &lt;int&gt;     &lt;int&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">##  1      1         1   24  </span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">##  2      1         2   32  </span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">##  3      1         3   39  </span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">##  4      1         4   42.5</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">##  5      1         5   48  </span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">##  6      1         6   54.5</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">##  7      1         7   61  </span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">##  8      1         8   65  </span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">##  9      1         9   72  </span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">## 10      2         1   22.5</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="co">## # … with 422 more rows</span></a></code></pre></div>
<p>We create <code>pig_df</code> by nesting weight within subject. The result is a data frame containing a single row for each pig, and columns for <code>id.num</code> and the <code>weight</code> function.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">pig_df =<span class="st"> </span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span>pig.weights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/tf_nest.html">tf_nest</a></span>(weight, <span class="dt">.id =</span> id.num, <span class="dt">.arg =</span> num.weeks)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">pig_df</a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">## # A tibble: 48 x 2</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">##    id.num weight                       </span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">##     &lt;int&gt; &lt;tfd_reg&gt;                    </span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">##  1      1 1: (1,24);(2,32);(3,39); ... </span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">##  2      2 2: (1,22);(2,30);(3,40); ... </span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">##  3      3 3: (1,22);(2,28);(3,36); ... </span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">##  4      4 4: (1,24);(2,32);(3,40); ... </span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">##  5      5 5: (1,24);(2,32);(3,37); ... </span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">##  6      6 6: (1,23);(2,30);(3,36); ... </span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">##  7      7 7: (1,22);(2,28);(3,36); ... </span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">##  8      8 8: (1,24);(2,30);(3,38); ... </span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">##  9      9 9: (1,20);(2,28);(3,33); ... </span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">## 10     10 10: (1,26);(2,32);(3,40); ...</span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">## # … with 38 more rows</span></a></code></pre></div>
<p>We’ll make a quick plot to show the result.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">pig_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> weight)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/ggspaghetti.html">geom_spaghetti</a></span>()</a></code></pre></div>
<p><img src="x02_Conversion_files/figure-html/unnamed-chunk-9-1.png" width="90%"></p>
<p>A second example uses the <code><a href="https://www.rdocumentation.org/packages/ALA/topics/fev1">ALA::fev1</a></code> dataset. <code>ALA</code> is not available on CRAN but can be installed using the line below.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"ALA"</span>, <span class="dt">repos=</span><span class="st">"http://R-Forge.R-project.org"</span>)</a></code></pre></div>
<p>In this dataset, both <code>height</code> and <code>logFEV1</code> are observed at multiple ages for each child; that is, there are two functions observed simultaneously, over a shared argument. We can use <code>tf_nest</code> to create a dataframe with a single row for each subject, which includes both non-functional covariates (like age and height at baseline), and functional observations <code>logFEV1</code> and <code>height</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">ALA<span class="op">::</span>fev1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n_obs =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(n_obs <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/tf_nest.html">tf_nest</a></span>(logFEV1, height, <span class="dt">.arg =</span> age)</a></code></pre></div>
</div>
<div id="in-wide-format" class="section level3">
<h3 class="hasAnchor">
<a href="#in-wide-format" class="anchor"></a>… in “wide” format</h3>
<p>In some cases functional data are stored in “wide” format, meaning that there are separate columns for each argument, and values are stored in these columns. In this case, <code>tf_gather</code> can be use to collapse across columns to produce a function for each subject.</p>
<p>The example below again uses the <code><a href="https://www.rdocumentation.org/packages/refund/topics/DTI">refund::DTI</a></code> dataset. We convert <code>cca</code> so that, instead of acting as a matrix, it is in “wide” format. We then use <code>tf_gather</code> to combine the <code>cca</code> observations into a function.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">dti_df =<span class="st"> </span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span>refund<span class="op">::</span>DTI <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">  </span>janitor<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/janitor/topics/clean_names">clean_names</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">starts_with</span>(<span class="st">"rcst"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/tf_gather.html">tf_gather</a></span>(<span class="kw">starts_with</span>(<span class="st">"cca"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="st">  </span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">## creating new tfd-column &lt;cca&gt;</span></a></code></pre></div>
</div>
</div>
<div id="other-formats" class="section level1">
<h1 class="hasAnchor">
<a href="#other-formats" class="anchor"></a>Other formats</h1>
<p><code>fda</code> and <code>fd</code> coming soon …</p>
</div>
<div id="reversing-the-conversion" class="section level1">
<h1 class="hasAnchor">
<a href="#reversing-the-conversion" class="anchor"></a>Reversing the conversion</h1>
<p><strong><code>tidyfun</code></strong> includes a wide range of tools for exploratory analysis and visualization, but some analysis approaches require data to be stored in more traditional formats. Several functions are available to aid in this conversion.</p>
<div id="conversion-to-data-frames" class="section level2">
<h2 class="hasAnchor">
<a href="#conversion-to-data-frames" class="anchor"></a>Conversion to data frames</h2>
<p>The functions <code>tf_unnest</code> and <code>tf_spread</code> reverse the operations in <code>tf_nest</code> and <code>tf_gather</code>, respectively – that is, they take a data frame with a functional observation and produce long or wide data frames. We’ll illustrate these with the <code>pig_df</code> data set.</p>
<p>First, to produce a long-format dataf rame, one can use <code>tf_unnest</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">pig_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/tf_unnest.html">tf_unnest</a></span>()</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="co">## # A tibble: 432 x 4</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co">##    id.num weight_id weight_arg weight_value</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co">##     &lt;int&gt; &lt;chr&gt;          &lt;int&gt;        &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co">##  1      1 1                  1         24  </span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">##  2      1 1                  2         32  </span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">##  3      1 1                  3         39  </span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co">##  4      1 1                  4         42.5</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">##  5      1 1                  5         48  </span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="co">##  6      1 1                  6         54.5</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="co">##  7      1 1                  7         61  </span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co">##  8      1 1                  8         65  </span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="co">##  9      1 1                  9         72  </span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="co">## 10      2 2                  1         22.5</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co">## # … with 422 more rows</span></a></code></pre></div>
<p>To produce a wide-format data frame, one can use <code>tf_spread</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">pig_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/tf_spread.html">tf_spread</a></span>()</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="co">## # A tibble: 48 x 10</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co">##    id.num weight_1 weight_2 weight_3 weight_4 weight_5 weight_6 weight_7</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co">##     &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co">##  1      1     24       32       39       42.5     48       54.5     61  </span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co">##  2      2     22.5     30.5     40.5     45       51       58.5     64  </span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="co">##  3      3     22.5     28       36.5     41       47.5     55       61  </span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">##  4      4     24       31.5     39.5     44.5     51       56       59.5</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">##  5      5     24.5     31.5     37       42.5     48       54       58  </span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">##  6      6     23       30       35.5     41       48       51.5     56.5</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">##  7      7     22.5     28.5     36       43.5     47       53.5     59.5</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co">##  8      8     23.5     30.5     38       41       48.5     55       59.5</span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">##  9      9     20       27.5     33       39       43.5     49       54.5</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="co">## 10     10     25.5     32.5     39.5     47       53       58.5     63  </span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="co">## # … with 38 more rows, and 2 more variables: weight_8 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="co">## #   weight_9 &lt;dbl&gt;</span></a></code></pre></div>
</div>
<div id="converting-back-to-a-matrix-or-data-frame" class="section level2">
<h2 class="hasAnchor">
<a href="#converting-back-to-a-matrix-or-data-frame" class="anchor"></a>Converting back to a matrix or data frame</h2>
<p>To convert <code>tf</code> vector to a matrix, use <code>as.matrix</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">weight_vec =<span class="st"> </span>pig_df<span class="op">$</span>weight</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"></a>
<a class="sourceLine" id="cb15-3" data-line-number="3">weight_matrix =<span class="st"> </span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="st">  </span>weight_vec <span class="op">%&gt;%</span><span class="st"> </span>as.matrix</a>
<a class="sourceLine" id="cb15-5" data-line-number="5"></a>
<a class="sourceLine" id="cb15-6" data-line-number="6">weight_matrix[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co">##      1    2    3    4    5</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="co">## 1 24.0 32.0 39.0 42.5 48.0</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="co">## 2 22.5 30.5 40.5 45.0 51.0</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co">## 3 22.5 28.0 36.5 41.0 47.5</span></a></code></pre></div>
<p>To convert a <code>tf</code> vector to a standalone data frame with <code>"id"</code>,<code>"arg"</code>,<code>"value"</code>-columns, use <code><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame()</a></code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">weight_vec <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>()</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co">## # A tibble: 432 x 3</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="co">##    id      arg value</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="co">##    &lt;ord&gt; &lt;int&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co">##  1 1         1  24  </span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="co">##  2 1         2  32  </span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="co">##  3 1         3  39  </span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co">##  4 1         4  42.5</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co">##  5 1         5  48  </span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="co">##  6 1         6  54.5</span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co">##  7 1         7  61  </span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="co">##  8 1         8  65  </span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="co">##  9 1         9  72  </span></a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="co">## 10 2         1  22.5</span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"><span class="co">## # … with 422 more rows</span></a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#conversion-from-matrices">Conversion from matrices</a></li>
      <li><a href="#conversion-from-a-data-frame">Conversion from a data frame</a></li>
      <li><a href="#other-formats">Other formats</a></li>
      <li>
<a href="#reversing-the-conversion">Reversing the conversion</a><ul class="nav nav-pills nav-stacked">
<li><a href="#conversion-to-data-frames">Conversion to data frames</a></li>
      <li><a href="#converting-back-to-a-matrix-or-data-frame">Converting back to a matrix or data frame</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Fabian Scheipl, Jeff Goldsmith.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
